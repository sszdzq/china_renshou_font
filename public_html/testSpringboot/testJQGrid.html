<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" href="../shared/bootstrap/css/bootstrap.min.css"  type="text/css" />
	<link rel="stylesheet" href="../shared/css/font-awesome.min.css"  type="text/css" />
	<link rel="stylesheet" href="../shared/css/document.css"  type="text/css" />
	<link rel="stylesheet" href="../shared/css/dj-bootstrap.css"  type="text/css" />
	<link rel="stylesheet" href="../shared/ztree/css/zTreeStyle.css" type="text/css" />
	<link rel="stylesheet" href="../shared/css/dj-tab.css"  type="text/css" />	
	<!-- jqgrid样式 -->
	<link href="../shared/jqgrid/css/ui.jqgrid.css" type="text/css"  rel="stylesheet" />
	<link href="../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css" type="text/css"  rel="stylesheet" />
	
	<!--javascript引用部分 -->
	<script src="../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
	<script src="./jquery.extend.js" type="text/javascript"></script>
	<script src="../shared/js/myLayer.js" type="text/javascript"></script>
	<script src="../shared/ztree/js/jquery.ztree.core.min.js" type="text/javascript"></script>
	<!-- jqgridjs -->
	<script src="../shared/jqgrid/js/jquery.jqGrid.src.js" type="text/javascript"></script>
	<script src="./jquery.jqGrid.extend.js" type="text/javascript"></script>
	<script type="text/javascript" src="../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>
	
	<!-- 文件上传jquery组件 -->
	<script type="text/javascript" src="../shared/js/ajaxfileupload.js"></script>
	
	<script src="../shared/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../shared/layer/layer.js" type="text/javascript"></script>
	<!-- my97 DatePicker  -->
	<script src="../shared/my97/WdatePicker.js" type="text/javascript"></script>	
	
	<script src="../shared/plugins/utils.js" type="text/javascript"></script>
</head>
<body>
<div class="pagecontent" >
<div class="middleLayer">
<!-- 页面主内容 -->	
<div class="toolbars">
	<form id="search_form_users" class="searchform" onsubmit="return false;">
		<input type="text" name="loginId"  id="loginId" placeholder="用户名"/>
		<button type="button" onclick="search_users()" class="btn"><i class="fa fa-th"></i> 查询</button>		
		<button type="button" onclick="isExist_user()" class="btn"><i class="fa fa-th"></i> 检查用户名</button>		
	</form>
</div>
<div class="gridcontent">
	<table id="t_users"></table>
	<div id="t_users_page"></div>
</div>
</div>
</div>
</body>
<script type="text/javascript">
function loadGrid_users() {
		$("#t_users").jqGrid(
			{
				url : 'http://localhost:8080/ESS/api/users',
				datatype : "json",//页面加载的时候不显示数据
				colNames : [ 'id','用户名','所属部门','姓名','创建人','创建时间'],
				colModel : [ 
							 {name : 'id',index : 'id',width : 100,key:true},
							 {name : 'loginId',index : 'loginId',width : 200,align : "center"},
				             {name : 'departmentId',index : 'departmentId',width : 150,align : "center"},
				             {name : 'name',index : 'name',width : 150,align : "center"},
				             {name : 'createdBy',index : 'createdBy',width : 220},
				             {name : 'createdAt',index : 'createdAt',width : 100,align:"center"}
				          ],
				pager : '#t_users_page'
			});
	}
	
	//查询功能
	function search_users() {
		var formData = getFormData("search_form_users");
		$("#t_users").jqGrid('setGridParam', {
			postData :{
				loginId:formData.loginId,
				page:1
			},
		    datatype : 'json' 
		}).trigger("reloadGrid",[{page:0}]);
	}
	
	function isExist_user(){
		var formData = getFormData("search_form_users");
		$.ajax({
			url:"http://localhost:8080/ESS/api/user/exist",
			type:"GET",
			data:{
				field:"loginId",
				value:formData.loginId
			},
			dataType:"json",
			success:function(data){
				if(data==true){				
					layer.alert("用户名可用", {icon: 5});
				}else{
					layer.alert(data, {icon: 5});
				}
			},
			error:function(jqXHR,textStatus,errorThrown){				
				var ret=$.parseJSON(jqXHR.responseText);	
				layer.alert("错误码:"+ret.code+",错误描述:"+ret.message, {icon: 5});
				
			}
		});
	}
	
//加载jqGrid
$(document).ready(function() {
	loadGrid_users();
	$(window).resize(function() {
        $("#t_users").jqGrid("autoSize");
	}).trigger('resize');	
	
});
</script>
</html>