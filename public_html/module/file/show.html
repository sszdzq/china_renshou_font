<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
	<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
	<META HTTP-EQUIV="Expires" CONTENT="0">
	<title>查看文档</title>

	<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.min.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/css/index-ess.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/css/font-awesome.min.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/css/document.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/css/dj-bootstrap.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/css/dj-tab.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/css/main.css" type="text/css"/>
	<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.css" type="text/css"/>
	<!-- jqgrid样式 -->
	<link href="../../shared/jqgrid/css/ui.jqgrid.css" type="text/css" rel="stylesheet"/>
	<link href="../../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css" type="text/css" rel="stylesheet"/>


	<!--javascript引用部分 -->
	<script src="../../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
	<script src="../../shared/js/jquery.extend.js" type="text/javascript"></script>
	<script src="../../shared/js/myLayer.js" type="text/javascript"></script>
	<script src="../../shared/ztree/js/jquery.ztree.core.min.js" type="text/javascript"></script>

	<!-- jqgridjs -->
	<script src="../../shared/jqgrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>
	<script src="../../shared/jqgrid/js/jquery.jqGrid.extend.js" type="text/javascript"></script>
	<script type="text/javascript" src="../../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>

	<script src="../../shared/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../../shared/layer/layer.js" type="text/javascript"></script>

	<!-- my97 DatePicker  -->
	<script src="../../shared/my97/WdatePicker.js" type="text/javascript"></script>
	<script src="../../shared/plugins/utils.js" type="text/javascript"></script>
	<script src="../../shared/ocx/hwpostil.js"  type="text/javascript" ></script>
	<style type="text/css">
		::-webkit-scrollbar-thumb {
			background: #d9d9d9;
			cursor: pointer;
		}

		select{
			width:auto;
			padding:3px;
		}
		body{
			padding: 0 15px;
		}
		.panel-body{
			padding: 5px;
		}
		form{
			font-size: 15px; width: 100%; border: 0px;
			margin-bottom: 0px !important;
		}
		.panel-heading{
			padding: 4px 15px;
		}

	</style>

</head>
<body>
<div class="margin-top-1" style="height:100%">
	<div class="panel-group" style="height:100%;">
		<div class="panel-default panel  panel-open" id="info" >
			<div role="tab"   class="panel-heading" onclick="showOrHide('info')">
				<h4 class="panel-title">
					<span ><i class="fa fa-chevron-right" aria-hidden="true"></i>文档基本信息(<font style="color:red">状态:<span id="status"></span></font>)</span>
				</h4>
			</div>
			<div   class="panel-collapse in collapse"  style="height: auto;">
				<div class="panel-body" id="infoBody" style="display:none;">
					<form id="fileMessage"  class="form-inline">
						<table id="fileTable" style="" class="table_insert">
							<tbody>
							<tr>
								<td class="tdtitle" align="right">文档编号：</td>
								<td><input type="text" id="doc_id" name="doci_id"class="form_input" disabled="disabled"></td>

								<td class="tdtitle" align="right">文档标题：</td>
								<td><input type="text" id="doc_title" name="doc_title"class="form_input" disabled="disabled"></td>

								<td class="tdtitle" align="right">归属机构：</td>
								<td><input type="text" id="dept_name" name="dept_name" class="form_input" disabled="disabled"></td>

							</tr>
							<tr>
								<td class="tdtitle" align="right">业务类型：</td>
								<td><input type="text" id="service" name="service" class="form_input" disabled="disabled"></td>

								<td class="tdtitle" align="right">提交人：</td>
								<td><input type="text" id="user_name" name="user_name" class="form_input" disabled="disabled"></td>
								<td class="tdtitle" align="right">提交时间：</td>
								<td><input type="text" id="create_time" name="create_time" class="form_input" disabled="disabled"></td>

							</tr>
							<tr >
								<td class="tdtitle" align="right">上一步办理状态：</td>
								<td><input type="text" id="last_status" name="last_status" class="pre_status" disabled="disabled"></td>

								<td class="tdtitle" align="right">上一步办理时间：</td>
								<td><input type="text" id="last_time" name="last_time" class="form_input" disabled="disabled"></td>

								<td class="tdtitle" align="right">请求分数：</td>
								<td><input type="text" id="max_num" name="max_num" class="form_input" disabled="disabled"></td>

							</tr>
							<tr >
								<td class="tdtitle" align="right">前办理人：</td>
								<td><input type="text" id="deal_user" name="deal_user" class="pre_status" disabled="disabled"></td>

								<td class="tdtitle" align="right">已打印分数：</td>
								<td><input type="text" id="cur_num" name="cur_num" class="form_input" disabled="disabled"></td>

								<td class="tdtitle" align="right">打印机构：</td>
								<td><input type="text" id="print_dept" name="print_dept" class="form_input" disabled="disabled"></td>

							</tr>
							</tbody>
						</table>
					</form>
				</div>
			</div>
		</div>
		<div class="panel panel-default" id="opinion" >
			<div  class="panel-heading"  onclick="showOrHide('opinion')">
				<h4 class="panel-title">
					<span ><i class="fa fa-chevron-right" aria-hidden="true"></i>显示/隐藏审核意见列表</span>
				</h4>
			</div>
			<div class="panel-body" id="opinionBody" style="display: none">
				<div style="text-align: center">此文档无审核意见!</div>
			</div>
		</div>

		<div class="panel panel-default" >
			<div class="panel-body" id="aip" name="aip">

			</div>
		</div>
	</div>

</div>




<script type="text/javascript">
	var services;
    var statusType=["起草","审核","盖章","打印","","补打申请","已归档","退回"];
    var approve_status=["起草","审核","盖章","打印","","补打申请","归档","审批退回","","盖章退回","补打拒绝","","补打通过"];
    var urlPath=getUrlPath();
    //创建控件对象
    var hwpobj =new HWPostil("aip");
    //初始化控件
    hwpobj.Init({id:"HWPostil2",designMode:1,showMenu:0,showScrollBar:0,});
    hwpobj.setSilentMode(1);
    hwpobj.setShowDefMenu(0);
    hwpobj.setShowToolBar(0);
    hwpobj.showScrollBarButton(3);
    //加载jqGrid
    $(document).ready(function() {
        $("#aip").height(500);
        var id=GetQueryString("id");
        informationInit(id);
    });
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  decodeURI(r[2]); return null;
    }
    function informationInit(id) {

        $.ajax({
            type : "GET",
            url : urlPath + "/files/"+id+"?noCache=" + new Date().getTime(),
            contentType : "application/json",
            dataType : "json",
            success : function(data) {
				if(data!=null){
				    $("#doc_id").val(data.doc_id);
                    $("#doc_title").val(data.doc_title);
                    $("#dept_name").val(data.dept_name);
                    $("#service").val(data.serv_name);
                    $("#user_name").val(data.user_name);
                    $("#create_time").val(new Date(data.created_at*1000).toLocaleString());
                    $("#last_status").val(statusType[data.last_status*1]);
                    $("#last_time").val(new Date(data.last_time).toLocaleString());
                    $("#max_num").val(data.max_num);
                    $("#deal_user").val(data.seal_user_name);
                    $("#cur_num").val(data.cur_num);
                    $("#print_dept").val(data.print_deptName);
                    $("#status").html(statusType[data.status*1]);
                    var approve_opinion=data.approve_opinion;
                    if(approve_opinion!=null&&approve_opinion.length>0){
                        $("#opinionBody").html("");
                        var resultString='';
						for(var i=0;i<approve_opinion.length;i++){
						    var opinion=approve_opinion[i];
                            resultString+='<div>【'+opinion.user_name+'&nbsp&nbsp'+new Date(opinion.add_time).toLocaleString('china')+'&nbsp&nbsp'+approve_status[opinion.make_type]+'】:'+opinion.app_data+'</div>';
						}
                        $("#opinionBody").append(resultString);
					}
                    if(data.base64!=null && data.base64!=""){
                        hwpobj.LoadFileBase64(data.base64);
                    }
				}
            },
            error : function(data) {

            }
        });
    }
    Date.prototype.toLocaleString = function(type) {
        var currMonth = (this.getMonth() + 1) < 10 ? '0'+(this.getMonth() + 1):(this.getMonth() + 1);
        var currDate = this.getDate() < 10 ? '0'+this.getDate():this.getDate();
        var currHours = this.getHours() < 10 ? '0'+this.getHours():this.getHours();
        var currMinutes = this.getMinutes() < 10 ? '0'+this.getMinutes():this.getMinutes();
        var currSeconds = this.getSeconds() < 10 ? '0'+this.getSeconds():this.getSeconds();
		if(type == "china"){
            return this.getFullYear() + "年" + currMonth + "月" + currDate + "日 " + currHours + ":" + currMinutes ;

        }else{
            return this.getFullYear() + "-" + currMonth + "-" + currDate + " " + currHours + ":" + currMinutes + ":" + currSeconds;

        }
    };

    function showOrHide(id){
		var element="#"+id+" .panel-heading .panel-title span i";
        if($(element).hasClass("fa-chevron-right")){
            $(element).addClass("fa-chevron-down");
            $(element).removeClass("fa-chevron-right");
        }else{
            $(element).removeClass("fa-chevron-down");
            $(element).addClass("fa-chevron-right");

        }
        $("#"+id+"Body").toggle(300);

    }

</SCRIPT>
</body>
</html>