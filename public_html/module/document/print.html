<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="0">

<title>打印设置</title>

<link rel="stylesheet"
	href="../../shared/bootstrap/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../../shared/css/index-ess.css"
	type="text/css" />
<link rel="stylesheet" href="../../shared/css/font-awesome.min.css"
	type="text/css" />
<link rel="stylesheet" href="../../shared/css/document.css"
	type="text/css" />
<link rel="stylesheet" href="../../shared/css/dj-bootstrap.css"
	type="text/css" />
<link rel="stylesheet" href="../../shared/css/dj-tab.css"
	type="text/css" />
<link rel="stylesheet" href="../../shared/css/main.css" type="text/css" />
<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.css"
	type="text/css" />
<!-- jqgrid样式 -->
<link href="../../shared/jqgrid/css/ui.jqgrid.css" type="text/css"
	rel="stylesheet" />
<link
	href="../../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css"
	type="text/css" rel="stylesheet" />


<!--javascript引用部分 -->
<script src="../../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="../../shared/js/jquery.extend.js" type="text/javascript"></script>
<script src="../../shared/js/myLayer.js" type="text/javascript"></script>
<script src="../../shared/ztree/js/jquery.ztree.core.min.js"
	type="text/javascript"></script>

<!-- jqgridjs -->
<script src="../../shared/jqgrid/js/jquery.jqGrid.min.js"
	type="text/javascript"></script>
<script src="../../shared/jqgrid/js/jquery.jqGrid.extend.js"
	type="text/javascript"></script>
<script type="text/javascript"
	src="../../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>

<script src="../../shared/bootstrap/js/bootstrap.min.js"
	type="text/javascript"></script>
<script src="../../shared/layer/layer.js" type="text/javascript"></script>

<!-- my97 DatePicker  -->
<script src="../../shared/my97/WdatePicker.js" type="text/javascript"></script>
<script src="../../shared/plugins/utils.js" type="text/javascript"></script>

<script src="../../shared/js/jquery.validate.min.js"type="text/javascript"></script>
<script src="../../shared/js/jquery.additional-methods.js"type="text/javascript"></script>
</head>
<body>
	<div class="pagecontent" id="divcontent2">
		<div class="middleLayer" style="margin:0px 0px 0px 0px;">
			<!-- 工具条 -->
			<div id="toolbars" class="toolbars" align="left" style="margin-top:5px">
				<form id="search_form"  class="searchform" onsubmit="return false;" style=" float:left;">
					<span class="add-on">编号</span>
					<input type="text" name="sn" id="sn" style="width: 80px" placeholder="文档编号"> 
					
					<span class="add-on">文档名称</span>
					<input type="text" name="fileName" id="fileName" style="width: 80px" placeholder="文档名称"> 
					
					<span class="add-on">时间段</span>
					<input type="text"  id="startTime" name="startTime" onfocus="WdatePicker({skin:'whyGreen',readOnly:true,dateFmt: 'yyyy-MM-dd',maxDate: '#F{$dp.$D(\'endTime\')}' }) ">
					-
					<input type="text" name="endTime" id="endTime" onfocus="WdatePicker({skin:'whyGreen',readOnly:true,dateFmt: 'yyyy-MM-dd',minDate:'#F{$dp.$D(\'startTime\') }'}) ">
					
					</form>
				<button type="button" onclick="search()" class="btn btn-success" style="float:right;margin-right: 15px"> 查询</button>
					</div>
			
			<!-- 页面主内容 -->	
			<div class="gridcontent" style="margin-top:5px">
				<table id="doc_table"></table>
				<div id="doc_page"></div>
			</div>
		</div>
	 </div>
</body>

<script type="text/javascript">
var urlPath=getUrlPath();
var lowerLevel=	false;
function loadGrid_doc() {
	$("#doc_table").jqGrid(
		{
			url : urlPath+'/documents?noCache='+new Date().getTime(),
			datatype : "json",//页面加载的时候不显示数据
			colNames : ['ID','文档编号','文档名称',/* '文档来源', */'所属部门','创建时间','操作'],
			colModel : [ 
						 {name : 'id',index : 'id',hidden:true},
						 {name : 'sn',index : 'sn',width : 200,align:"center"},
						 {name : 'name',index : 'name',width : 200,align : "center"},
			             /* {name : 'sourceType',index : 'sourceType',width : 130,align : "center",formatter:typeFormatter},
			              */
			             {name : 'departmentName',index : 'departmentName',width : 150,align : "center"},
			             {name : 'create_time',index : 'create_time',width : 150,align:"center",formatter:timeFormatter},
			           	 {name : '',index : '',width : 200,align:"center" ,formatter:opFormatter},
			            ], 
						multiselect: false,
						rowNum : 10,
						rowList : [ 10, 15,30 ],
			pager : '#doc_page'
		});
	}

	//加载jqGrid
	$(document).ready(function() {
		loadGrid_doc();
		$(window).resize(function() {
	        $("#doc_table").jqGrid("autoSize");
		}).trigger('resize');	
		
	});
	
	 function opFormatter(cellvalue, options, rowObject){
		return "<a style=\"color:blue\" href=\"javascript:showlog('"+rowObject.sn+"');\">打印日志</a>"+"|"
		+"<a style=\"color:blue\" href=\"javascript:showprint('"+rowObject.sn+"','"+rowObject.id+"');\">打印设置</a>"+"|"
		+"<a style=\"color:blue\" href=\"javascript:openEdit_detial('"+rowObject.id+"');\">详细</a>"
	 }
	 
	 function showlog(sn){
		 var index = window.layer.open({
				title:'打印日志',  
				type: 2,
				content: '../../module/document/print-logs.html?doc_sn='+sn+'&noCache='+new Date().getTime(),
				area: ['80%', '80%'],
				btn: ['保存','关闭'], //底部按钮区域
			});
	 }
	 
	 function showprint(sn,id){
		 var index = window.layer.open({
				title:'打印设置',  
				type: 2,
				content: '../../module/document/print-setting.html?doc_sn='+sn+'&id='+id+'&noCache='+new Date().getTime(),
				area: ['80%', '80%'],
				btn: ['保存','关闭'], //底部按钮区域
			});
	 }
	 
	 function openEdit_detial(id){
			var index = window.layer.open({
				title:'文档详情',  
				type: 2,
				content: '../../module/document/print-details.html?id='+id,
				area: ['80%', '80%'],
				btn: ['保存','关闭'], //底部按钮区域
			});
		}
	 
	   function search(){
		   //解决postData参数值累加问题，首先清空postData
		    var postData = $('#doc_table').jqGrid("getGridParam", "postData");
            $.each(postData, function (k, v) {
                delete postData[k];
            });                    
		   var formData = getFormData("search_form");
		   var data={};
		   if(formData.fileName!=""){
			   data['fileName']=formData.name;
		   }
		   if(formData.sn!=""){
			   data['sn']=formData.sn;
		   }
		   if(formData.startTime!=""){
			   data['startTime']=new Date(Date.parse(formData.startTime.replace(/-/g,"/"))).getTime()/1000;
			   //data['startTime']=new Date(formData.startTime).getTime()/1000;
		   }
		   if(formData.endTime!=""){
			   data['endTime']=new Date(Date.parse(formData.endTime.replace(/-/g,"/"))).getTime()/1000 + nextDayTime;
			  // data['endTime']=new Date(formData.endTime).getTime()/1000;
		   }

	 	 $("#doc_table").jqGrid('setGridParam', {
				page : 1,
				postData :data
			}).trigger("reloadGrid"); 
	   }
	   
	function timeFormatter(cellvalue, options, rowObject) {
		var unixTimestamp = new Date(cellvalue*1000) ;
		return unixTimestamp.toLocaleString();	
	}

	function doFresh(){
		 $("#doc_table").jqGrid('setGridParam',{									 
				postData:{}
			}).trigger("reloadGrid"); 
	}

   Date.prototype.toLocaleString = function() {
	   var currMonth = (this.getMonth() + 1) < 10 ? '0'+(this.getMonth() + 1):(this.getMonth() + 1);
	   var currDate = this.getDate() < 10 ? '0'+this.getDate():this.getDate();
	   var currHours = this.getHours() < 10 ? '0'+this.getHours():this.getHours();
	   var currMinutes = this.getMinutes() < 10 ? '0'+this.getMinutes():this.getMinutes();
	   var currSeconds = this.getSeconds() < 10 ? '0'+this.getSeconds():this.getSeconds();

       return this.getFullYear() + "-" + currMonth + "-" + currDate + " " + currHours + ":" + currMinutes + ":" + currSeconds;
   };
</script>
</html>

