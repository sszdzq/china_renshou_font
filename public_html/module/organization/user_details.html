<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="0">
<title>用户信息</title>
  	<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.min.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/index-ess.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/font-awesome.min.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/document.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/dj-bootstrap.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/dj-tab.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/main.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.css"  type="text/css" />
	    <!-- jqgrid样式 -->
	    <link href="../../shared/jqgrid/css/ui.jqgrid.css" type="text/css"  rel="stylesheet" />
	    <link href="../../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css" type="text/css"  rel="stylesheet" />
	    
	    
	    	<!--javascript引用部分 -->
	   <script src="../../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
       <script src="../../shared/js/jquery.extend.js" type="text/javascript"></script>
	   <script src="../../shared/js/myLayer.js" type="text/javascript"></script>
	   <script src="../../shared/ztree/js/jquery.ztree.core.min.js" type="text/javascript"></script>
	   
		<!-- jqgridjs -->
	    <script src="../../shared/jqgrid/js/jquery.jqGrid.src.js" type="text/javascript"></script>
	    <script src="../../shared/jqgrid/js/jquery.jqGrid.extend.js" type="text/javascript"></script>
       <script type="text/javascript" src="../../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>
		
		<script src="../../shared/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	    <script src="../../shared/layer/layer.js" type="text/javascript"></script>
	    
	    	<!-- my97 DatePicker  -->
	    <script src="../../shared/my97/WdatePicker.js" type="text/javascript"></script>	
	    <script src="../../shared/plugins/utils.js" type="text/javascript"></script>
</head>
<body>
	<div class="panel panel-default" style="width:100%;height:100%; border:1px solid black;">
	    <div class="panel-heading" style="width:95%;margin-top:10px;margin-bottom:0px;"  >
	        <h3 class="panel-title"  style="display: inline">个人基本信息</h3>
	    </div>
	    <div class="panel-body" style="width:95%;border:1px solid lightgrey">
	      <table class="table table-condensed">
			<tbody>
				<tr>
					<td style="BORDER:NONE;text-align:right">用户名:</td>
					<td id="loginId" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">姓名:</td>
					<td id="name" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">生日:</td>
					<td id="birthday" style="BORDER:NONE;text-align:left"></td>
				</tr>
				<tr>
					<td style="BORDER:NONE;text-align:right">性别:</td>
					<td id="gender" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">创建时间:</td>
					<td id="createdAt" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">手机:</td>
					<td id="mobile" style="BORDER:NONE;text-align:left"></td>
				</tr>
				<tr>
					<td style="BORDER:NONE;text-align:right">创建人:</td>
					<td id="createdBy" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">邮箱:</td>
					<td id="email" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">是否启用:</td>
					<td id="status" style="BORDER:NONE;text-align:left"></td>
				</tr>
				<tr>
					<td style="BORDER:NONE;text-align:right">所属部门:</td>
					<td id="departmentName" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">工作电话:</td>
					<td id="workTelephone" style="BORDER:NONE;text-align:left"></td>
					<td style="BORDER:NONE;text-align:right">上次更新时间:</td>
					<td id="updatedAt" style="BORDER:NONE;text-align:left"></td>
				</tr>
			</tbody>
		</table>
	    </div>
	    
	    <div class="panel-heading" style="width:95%;margin-top:50px;">
	        <h3 class="panel-title">角色信息</h3>
	    </div>
	    <div class="panel-body" style="width:95%;border:1px solid lightgrey">
	    	<div id="role"></div>			
		</div>
		
		<div class="panel-heading" style="width:95%;margin-top:50px;">
	        <h3 class="panel-title">印章信息</h3>
	    </div>
	    <div class="panel-body" style="width:95%;border:1px solid lightgrey">
	    	<div id="seal"></div>			
		</div>
		
		<div class="panel-heading" style="width:95%;margin-top:50px;">
	        <h3 class="panel-title">管理部门</h3>
	    </div>
	    <div class="panel-body" style="width:95%;border:1px solid lightgrey">
	    	<div id="department"></div>			
		</div>

		<div class="panel-heading" style="width:95%;margin-top:50px;">
			<h3 class="panel-title">业务类型</h3>
		</div>
		<div class="panel-body" style="width:95%;border:1px solid lightgrey">
			<div id="service"></div>
		</div>
		</div>
</body>
<script type="text/javascript">
var aipUrl = getUrlPath();
//取地址栏参数
function getUrlParms(name){
	   var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	   var r = window.location.search.substr(1).match(reg);
	   if(r!=null)
	   return unescape(r[2]);
	   return null;
	   } 
	   //时间格式化
     Date.prototype.toLocaleString = function() {
	   var currMonth = (this.getMonth() + 1) < 10 ? '0'+(this.getMonth() + 1):(this.getMonth() + 1);
	   var currDate = this.getDate() < 10 ? '0'+this.getDate():this.getDate();
	   var currHours = this.getHours() < 10 ? '0'+this.getHours():this.getHours();
	   var currMinutes = this.getMinutes() < 10 ? '0'+this.getMinutes():this.getMinutes();
	   var currSeconds = this.getSeconds() < 10 ? '0'+this.getSeconds():this.getSeconds();

       return this.getFullYear() + "-" + currMonth + "-" + currDate + " " + currHours + ":" + currMinutes + ":" + currSeconds;
   }; 
		//页面加载函数
		$(function(){
			//查询用户基本信息
		var id = getUrlParms("id");
			//console.log(id);
		
			$.ajax({
				type : "GET",
				url : aipUrl+"/userSeal/"+id+"?&date="+new Date().getTime(),
				dataType : "json",
				async:false,
				contentType: "application/json; charset=utf-8",
				success : function(data) {
				//console.log(data);
			
				//用户基本信息
				$("#loginId").text(data.user.loginId);//用戶名
				$("#name").text(data.user.name);//姓名
				if(data.user.birthday==null){//生日
					$("#birthday").text("--");
				}else{
					$("#birthday").text(new Date(data.user.birthday*1000).toLocaleString());
				}
				
				if(data.user.gender==0){//姓名
					$("#gender").text("女");
				}else{
					$("#gender").text("男");
				}
			$("#createdAt").text(new Date(data.user.createdAt*1000).toLocaleString()); //创建时间
			if(data.user.mobile==null){//手机号码
				$("#mobile").text("--");
			}else{
				$("#mobile").text(data.user.mobile);
			}
			//创建人
			if(data.user.createdBy==null){
				$("#createdBy").text("系统创建");
			}else{
				$("#createdBy").text(data.user.createdBy);
			}
			
			//邮箱
			if(data.user.email==null){
				$("#email").text("--");
			}else{
				$("#email").text(data.user.email);
			}
			//是否启用
			if(data.user.status==1){
				$("#status").text("启用");	
			}else{
				$("#status").text("未启用");	
			}
			//所属部门
			if(data.user.departmentId==null){
				$("#departmentName").text("--");
			}else{
				$("#departmentName").text(data.user.departmentId.name);
			}
			//电话
			if(data.user.workTelephone==null){
				$("#workTelephone").text("--");
			}else{
				$("#workTelephone").text(data.user.workTelephone);
			}
			
			//上一次跟新时间
			if(data.user.updatedAt==null){
				$("#updatedAt").text("--");
			}else{
				$("#updatedAt").text(new Date(data.user.updatedAt*1000).toLocaleString());
			}
			//角色信息
			var roleArr=data.user.userRoles;
			if(roleArr!=null){
				if(roleArr.length<=0){
					$("#role").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");

				}
				for(var i=0;i<roleArr.length;i++){
					
					$("#role").append("<span  style='margin:8px 0 0 8px;background-color:#5bc0de;font-size:100%;padding:7px 12px;display:inline-block;color: #fff'>"+roleArr[i].name+"</span>");
				}
			}else{
				$("#role").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");
			}
			//印章管理
			var sealArr=data.userSeals;
			if(sealArr!=null){
				if(sealArr.length<=0){
					$("#seal").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");
				}
				for(var i=0;i<sealArr.length;i++){
					var previewData = 'data:image/png;base64,' + sealArr[i].previewData
					$("#seal").append("<img src='"+ previewData+"' style='margin-right:60px;border:1px solid #ddd' />");
				}
			}else{
			
				$("#seal").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");
			}
			
			//管理部门
			var manageArr=data.user.manageDepartments;
			if(manageArr!=null){
				//console.log(manageArr)
				if(manageArr.length<=0){
					$("#department").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");

				}else{
					for(var i=0;i<manageArr.length;i++){
						var value="";
						if(manageArr[i].type==1){
						value=manageArr[i].departmentId.name+"-"+manageArr[i].roleId.name+"-"+"包含下级";
						}else{
							value=manageArr[i].departmentId.name+"-"+manageArr[i].roleId.name+"-"+"不包含下级";
						}
						
						$("#department").append("<span  style='margin:8px 0 0 8px;background-color:#5cb85c;font-size:100%;padding:7px 12px;display:inline-block;color: #fff'>"+value+"</span>");
					}
				}
			}else{
				$("#department").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");
			}

					//业务类型
					var serviceArr=data.user.userServices;
					if(serviceArr!=null){
						if(serviceArr.length<=0){
							$("#service").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");

						}
						for(var i=0;i<serviceArr.length;i++){

							$("#service").append("<span  style='margin:8px 0 0 8px;background-color:#5bc0de;font-size:100%;padding:7px 12px;display:inline-block;color: #fff'>"+serviceArr[i].servName+"</span>");
						}
					}else{
						$("#service").append("<span style='color:#dcdcdc;' class='fa fa-exclamation-triangle'>这里什么都没有！</span>");
					}
				}//success
			});
		})
</script>
</html>