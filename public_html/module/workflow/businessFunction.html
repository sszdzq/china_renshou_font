<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>业务功能</title>
<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.min.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/index-ess.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/font-awesome.min.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/document.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/dj-bootstrap.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/dj-tab.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/main.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.css"  type="text/css" />
	    <!-- jqgrid样式 -->
	    <link href="../../shared/jqgrid/css/ui.jqgrid.css" type="text/css"  rel="stylesheet" />
	    <link href="../../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css" type="text/css"  rel="stylesheet" />
	    
	    
	    	<!--javascript引用部分 -->
	   <script src="../../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
	   <script src="../../shared/js/jquery.extend.js" type="text/javascript"></script>
	   <script src="../../shared/js/myLayer.js" type="text/javascript"></script>
	   <script src="../../shared/ztree/js/jquery.ztree.core.min.js" type="text/javascript"></script>
	   
		<!-- jqgridjs -->
	    <script src="../../shared/jqgrid/js/jquery.jqGrid.src.js" type="text/javascript"></script>
		<script src="../../shared/jqgrid/js/jquery.jqGrid.extend.js" type="text/javascript"></script>
		<script type="text/javascript" src="../../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>
		
		<script src="../../shared/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	    <script src="../../shared/layer/layer.js" type="text/javascript"></script>
	    
	    	<!-- my97 DatePicker  -->
	    <script src="../../shared/my97/WdatePicker.js" type="text/javascript"></script>	
	    
	    <script src="../../shared/plugins/utils.js" type="text/javascript"></script>
<style type="text/css">
a{
	color: blue !important;
	font-weight: normal;
	margin-right: 5px;
}
</style>

</head>
<body>
<div class="pagecontent" id="divcontent2">
	<div class="centerLayer">
		<!-- 工具条 -->
		<div id="toolbars" class="toolbars">
			<button  onclick="newGn()" class="btn btn-danger" id="yw0" name="yt0" type="button">
				<i class="fa fa-plus-square"></i> 新增
			</button>
			<!-- 				<button  onclick="doAction(2);" class="btn" id="yw1" name="yt1" type="button"> -->
			<!-- 					<i class=""></i> 修改 -->
			<!-- 				</button> -->
			<!-- 				<button  onclick="doAction(3);" class="btn" id="yw2" name="yt2" type="button"> -->
			<!-- 					<i class=""></i> 删除 -->
			<!-- 				</button> -->
			<form id="search_form" class="searchform" onsubmit="return false;">
				<input type="text" name="gnmc"  id="gnmc" placeholder="功能名称" />
				<button type="button" onclick="search()" class="btn btn-primary"><i class="fa fa-th"></i> 查询</button>
			</form>
		</div>
		<!-- 页面主内容 -->
		<div class="gridcontent">
			<table id="invoice_grid"></table>
			<div id="ywgnmap"></div>
		</div>
	</div>
</div>
</body>
<script type="text/javascript">
    //初始化layer
    $("#divcontent2").mylayer("init");
    var urlPath=getUrlPath();
    function loadGrid() {
        $("#invoice_grid").jqGrid({
            url : urlPath+'/LcYwgnController/lcywgnQueryPage',
            datatype : "json", //页面加载的时候不显示数据
            colNames : [ '操作','功能ID', '功能名称','系统编码','系统名称','系统功能编码','系统功能名称','功能状态','URL地址','当前状态','备注'],
            colModel : [
                {name : 'cz',index : 'cz',width : 100,sortable:false,align:"center",formatter:function(cellvalue, options, rowObject){
                    return "<a href='javascript:updateData(\""+rowObject.gnid+"\")'>修改</a><a href='javascript:deteleData(\""+rowObject.gnid+"\")'>删除</a>";
                }},
                {name : 'gnid',index : 'gnid',width : 100,hidden : true},
                {name : 'gnmc',index : 'gnmc',width : 100,align : "center"},
                {name : 'ywxtbm',index : 'ywxtbm',width : 100,align : "center"},
                {name : 'ywxtmc',index : 'ywxtmc',width : 150,align : "center"},
                {name : 'xtgnbm',index : 'xtgnbm',width : 100,align : "center"},
                {name : 'xtgnmc',index : 'xtgnmc',width : 100,align : "center"},
                {name : 'ywzt',index : 'ywzt',width : 100,align : "center"},

                {name : 'url',index : 'url',width : 250},
                {name : 'dqzt',index : 'dqzt',width : 100,align : "center",formatter : function dqztFormatter(cellvalue, options, rowObject) {
                    if (cellvalue == 0) {
                        return "无效";
                    }
                    if (cellvalue == 1) {
                        return "有效";
                    }
                }},
                {name : 'bz',index : 'bz',width : 300},
            ],
            pager : '#ywgnmap',
            multiselect : false, //多行
            rownumbers : true //显示行号
        });
    }

    //加载jqGrid
    $(document).ready(function() {
        loadGrid();

        $(window).resize(function() {
            $("#invoice_grid").jqGrid("autoSize");
        }).trigger('resize');
    });

    //绑定回车事件
    document.onkeydown = function(e) {
        var ev = document.all ? window.event : e;
        if (ev.keyCode == 13) {
            search();
        }
    };

    //查询功能
    function search() {
        var formData = $("#search_form").getData();
        $("#invoice_grid").jqGrid('setGridParam', {
            postData : {
                gnmc : formData.gnmc
            }
        }).trigger("reloadGrid");
    }

    //刷新
    function doFresh(){
        $("#invoice_grid").jqGrid('setGridParam',{
            postData:{}
        }).trigger("reloadGrid");
    }

    //新增功能
    function newGn(){
        openEdit();
    }

    //修改功能
    function updateData(gnid){
        openEdit(gnid);
    }

    //删除功能
    function deteleData(gnid){
        //删除提示
        layer.alert('确定要删除此数据？', {
            time: 0, //不自动关闭,
            btn: ['确定', '关闭'],
            yes: function(index){
                $.ajax({
                    type : "POST",
                    url : urlPath+"/LcYwgnController/delLcYwgn",
                    data : {gnid:gnid},
                    dataType : "json",
                    traditional: true,//ajax传递数组的时候traditional必须为true
                    success : function(retdata) {
                        if (retdata.code == 200) {
                            msg('操作成功！');
                            layer.close(index);
                            //刷新jqGrid
                            doFresh();
                        } else {
                            alert(retdata.message);
                        }
                    }
                });
            }
        });
    }

    //编辑框
    function openEdit(gnid) {
        layer.open({
            title:'业务功能信息',
            type: 2,
            content:'../workflow/businessFunction_add.html?gnid='+gnid,
            area: ['900px', '400px'],
            btn: ['保存','关闭'], //底部按钮区域
            maxmin: true,
            yes: function(index,layero){  //第一个按钮的事件
                //调用子页面的方法
                window["layui-layer-iframe" + index].saveData(index);
            }
        });
    }

</script>
</html>