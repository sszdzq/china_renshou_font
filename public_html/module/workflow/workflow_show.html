<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>查看工作做流信息</title>

  	<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.min.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/index-ess.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/font-awesome.min.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/document.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/dj-bootstrap.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/dj-tab.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.css"  type="text/css" />
		<link rel="stylesheet" href="../../shared/css/index-ess.css"  type="text/css" />
	    <!-- jqgrid样式 -->
	    <link href="../../shared/jqgrid/css/ui.jqgrid.css" type="text/css"  rel="stylesheet" />
	    <link href="../../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css" type="text/css"  rel="stylesheet" />
	    
	    
	    	<!--javascript引用部分 -->
	   <script src="../../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
	   <script src="../../shared/js/jquery.extend.js" type="text/javascript"></script>
	   <script src="../../shared/js/myLayer.js" type="text/javascript"></script>
	   <script src="../../shared/ztree/js/jquery.ztree.core.min.js" type="text/javascript"></script>
	   
		<!-- jqgridjs -->
	    <script src="../../shared/jqgrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>
		<script src="../../shared/jqgrid/js/jquery.jqGrid.extend.js" type="text/javascript"></script>
		<script type="text/javascript" src="../../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>
		
		<script src="../../shared/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	    <script src="../../shared/layer/layer.js" type="text/javascript"></script>	    
	    <!-- my97 DatePicker  -->
	    <script src="../../shared/my97/WdatePicker.js" type="text/javascript"></script>	
	    <script src="../../shared/plugins/utils.js" type="text/javascript"></script>
	     <script src="../../shared/ocx/makeseal.js"  type="text/javascript" ></script>
	<style type="text/css">
		.table {
			margin-bottom: 0px;
		}
		td{text-align: center !important;}
	</style>
</head>
<body>
<table class="table_insert" cellpadding="0" cellspacing="0" style="border-collapse: collapse; width: 99%">
	<tr>
		<th style="height: 30px; width: 100%; text-align: center; font-size: 15px"><b>::审核流程::</b></th>
	</tr>
	<tr>
		<td style="padding-bottom: 5px">
			<div id="splcdiv" style="width: 100%;"></div>
		</td>
	</tr>
</table>
<table id="tab_shgc" style="width: 100%; margin-top: 1px" class="table table-striped">
	<thead>
	<tr>
		<th style="width: 15%; text-align: center;">节点</th>
		<th style="width: 15%; text-align: center;">送审时间</th>
		<th style="width: 20%; text-align: center;">审核人</th>
		<th style="width: 15%; text-align: center;">审核时间</th>
		<th style="width: 28%; text-align: center;">审核意见</th>
		<th style="width: 7%; text-align: center;">操作</th>
	</tr>
	</thead>
	<tbody id="tabbody_shgc">
	</tbody>
</table>
</body>
<script type="text/javascript">
    var urlPath=getUrlPath();
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  decodeURI(r[2]); return null;
    }
    //初始化工作流程图
    $(document).ready(function() {
        var slid_= GetQueryString("slid");
        var gzlid_= GetQueryString("gzlid");
        //查询流程图
        $.post(urlPath+"/lcdyController/getExeGzlcJd?_rm="+Math.random(),{gzlid:gzlid_,slid:slid_},function(retval){
            var divgzl=$("#splcdiv");
            if(retval.flag){
                $.each(retval.data,function(tin,titem){
                    var hexe="";
                    if(titem.hasexe=="Y"){
                        hexe="<span class='splcD'></span>";
                    }
                    var _tutype=(titem.etype=="one"?" 或 ":" 和 ");
                    var _uhtml="";
                    for(var i=0;i<titem.users.length;i++){
                        if(i>0){
                            _uhtml+=_tutype;
                        }
                        _uhtml+="<span uid='"+titem.users[i].yhid+"' data-hasqtip='15'>"+titem.users[i].yhxm+"</span>"+hexe;
                    }

                    if(_uhtml==""){
                        _uhtml="无";
                    }

                    var _nexthtml="";
                    if(titem.islast!="Y"){
                        _nexthtml="<span class='splcE'></span>";
                    }
                    divgzl.append("<div class='splcA' nodeid='"+titem.jdid+"'><span class='splcB'>"+titem.gnmc+"</span><span class='splcC'>【"+_uhtml+"】</span>"+_nexthtml+"</div>");
                });
                //
            }else{
                alert("未定义流程！");
            }
        },"json");
        //获取审核过程
        $.post(urlPath+"/lcdyController/getShgc?_rm="+Math.random(),{gzlid:gzlid_,slid:slid_},function(retval){
            var tabshgc=$("#tabbody_shgc");
            if(retval.flag){
                $.each(retval.data,function(tin,titem){

                    tabshgc.append("<tr><td>"+titem.jdsm+"</td><td>"+new Date(titem.firsttime).toLocaleString()+"</td><td>"+titem.jyhxm+"【"+titem.jyhdwmc+"】</td><td>"+new Date(titem.xxclrq).toLocaleString()+"</td><td>"+titem.shyj+"</td><td>"+titem.czlx+"</td></tr>");
                });
            }else{
                msg(retval.message);
            }
        },"json");
    });
    Date.prototype.toLocaleString = function() {
        var currMonth = (this.getMonth() + 1) < 10 ? '0'+(this.getMonth() + 1):(this.getMonth() + 1);
        var currDate = this.getDate() < 10 ? '0'+this.getDate():this.getDate();
        var currHours = this.getHours() < 10 ? '0'+this.getHours():this.getHours();
        var currMinutes = this.getMinutes() < 10 ? '0'+this.getMinutes():this.getMinutes();
        var currSeconds = this.getSeconds() < 10 ? '0'+this.getSeconds():this.getSeconds();

        return this.getFullYear() + "-" + currMonth + "-" + currDate + " " + currHours + ":" + currMinutes + ":" + currSeconds;
    };
</script>
</html>