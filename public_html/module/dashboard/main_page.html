<!DOCTYPE html> 
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<link rel="stylesheet" href="../../shared/bootstrap/css/bootstrap.min.css"  type="text/css" />
	<link rel="stylesheet" href="../../shared/css/font-awesome.min.css"  type="text/css" />
	<link rel="stylesheet" href="../../shared/css/document.css"  type="text/css" />
	<link rel="stylesheet" href="../../shared/css/dj-bootstrap.css"  type="text/css" />
	<link rel="stylesheet" href="../../shared/ztree/css/zTreeStyle.css" type="text/css" />
	<link rel="stylesheet" href="../../shared/css/dj-tab.css"  type="text/css" />	
	<!-- jqgrid样式 -->
	<link href="../../shared/jqgrid/css/ui.jqgrid.css" type="text/css"  rel="stylesheet" />
	<link href="../../shared/jqgrid/css/css/flick/jquery-ui-1.8.16.custom.css" type="text/css"  rel="stylesheet" />
	
	<!--javascript引用部分 -->
	<script type="text/javascript" src="../../shared/html5/html5shiv.min.js"></script>
	<script type="text/javascript" src="../../shared/respond/respond.src.js"></script>
	<script src="../../shared/js/jquery-1.8.3.min.js" type="text/javascript"></script>
	<script src="../../shared/js/jquery.extend.js" type="text/javascript"></script>
	<script src="../../shared/js/myLayer.js" type="text/javascript"></script>
	<script src="../../shared/ztree/js/jquery.ztree.core.min.js" type="text/javascript"></script>
	<!-- jqgridjs -->
	<script src="../../shared/jqgrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>
	<script src="../../shared/jqgrid/js/jquery.jqGrid.extend.js" type="text/javascript"></script>
	<script type="text/javascript" src="../../shared/jqgrid/js/i18n/grid.locale-cn.js"></script>
	
	<!-- 文件上传jquery组件 -->
	<script type="text/javascript" src="../../shared/js/ajaxfileupload.js"></script>
	
	<script src="../../shared/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../../shared/layer/layer.js" type="text/javascript"></script>
	<!-- my97 DatePicker  -->
	<script src="../../shared/my97/WdatePicker.js" type="text/javascript"></script>	
	
	<script src="../../shared/plugins/utils.js" type="text/javascript"></script>
	<script src="../../shared/main/js/jquery.treeview.js" type="text/javascript"></script>
	<script src="../../shared/js/json2.js" type="text/javascript"></script>

<link href="../../shared/main/css/default.css" rel="stylesheet" type="text/css" />
<link href="../../shared/main/css/keyframes.css" rel="stylesheet" type="text/css" />
<link href="../../shared/main/css/jquery.mCustomScrollbar.css" rel="stylesheet" type="text/css" />
<link href="../../shared/main/css/navBar.css" rel="stylesheet" type="text/css" />
<style type="text/css">

</style>
</head>
<body>

<div class="webhmoe noselect">
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display:none">
		<div class="modal-dialog" >
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align:left">选择切换身份</h4>
				</div>
				<div class="modal-body" >
					<div class="row">
				        <div class="col-xs-10 col-xs-offset-1" style="margin-left:8%;width:80%">
				            <select class="form-control ipt" name="type" id="identity" style="display: block;width: 100%;height: 34px;padding: 6px 12px;">
				                <option value="">请选择...</option>
				            </select>
				        </div>
				    </div>
				</div>
				<div class="modal-footer text-align-center">
				  <button type="button"
				          class="btn col-padding-3 margin-right-2 btn-primary btn-lg" onclick="changeRole()">确定</button>
				  <button type="button" class="btn btn-default col-padding-3 " onclick="closeModal()">取消</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div><!-- /.modals -->
	<div class="homeNav" id="div_homeNav">
		<div class="userInfo" id="div_userinfo">
			<u><div style="width:100%;height:100%" ><img src="../../shared/images/renlogo.png" width="100%" /></div></u>
		</div>
		<div class="customScroll" id="div_customScroll">
			<div class="tree" id="menutree">
				<cite><img src="../../shared/images/renshoumin.png" /></cite>
				<ul id="treeId">				
				</ul>
			</div>
		</div>
	</div>
	<div class="main" id="div_main">
		<div class="header">
			<div class=" page-top message ">
				<b id="navBut"></b>
				 <ul class="nav navbar-nav navbar-right">
				    <li class=" col-padding font-s16 margin-top-2  text-info" id="userLayer"></li>
				    <li class="border-left-1 col-padding bt">
				        <img class="user-img" src="../../shared/images/assets/headPortrait/Fruit-2.png" >
				    </li>
				    <li class="border-left-1">
				      <a  class="profile-toggle-link font-s16 dropdown-toggle"  id="messageLayer" >
				        <i class="fa fa-bell-o" aria-hidden="true"></i>
				        <span  class="show-has-message" id="redPoint" style="display:none;behavior: url(../../shared/js/pie/pie.htc);"></span>
				      </a>
				    </li>
				    <li class="border-left-1 dropdown" >
				      <a  class="font-s16"  data-toggle="dropdown">
				        <i class="fa fa-cogs" aria-hidden="true"></i>
				      </a>
				      <ul class="top-dropdown-menu profile-dropdown dropdown-menu" >
				        <li><i class="dropdown-arr"></i></li>
				        <li><a href="javascript:void(0);" onclick="openAccount();"><i class="fa fa-user" ></i>我的账户</a></li>
				        <li><a href="javascript:void(0);" onclick="openChangeRole();"><i class="fa fa-reply-all"></i>切换身份</a></li>
				      </ul>
				    </li>
				    <li class="border-left-1">
				      <a href="javascript:void(0);" onclick="logout()" class="margin-right font-s20" title="退出登录"><i class="fa fa-sign-out" aria-hidden="true"></i></a>
				    </li>
				  </ul>			
			</div>
			<div class="tabs" id="div_tabs">
				<div>
					<u id="showPrev"></u>
					<i class="cur" onmouseup="gotoTab(this,new Date().getTime())" id="tab_dbsy">首页<s></s></i>
					<b id="showNext"></b>
				</div>
			</div>
		</div>
		<!-- 页面显示区域 -->
		<div class="date" id="div_content">
			<iframe class="DatePage" src="./dashboard.html" id="ifr_tab_dbsy" frameborder="0" style="margin: 0px;padding: 0px" scrolling="auto" width="100%" height="100%"></iframe>
		</div>
		<div class="footer">电子印章管理系统</div>
	</div>
</div>

<script src="../../shared/main/js/jquery.treeview.js" type="text/javascript"></script>
<script src="../../shared/main/js/jquery.mousewheel.min.js" type="text/javascript"></script>
<script src="../../shared/main/js/jquery.mCustomScrollbar.min.js" type="text/javascript"></script>
<script src="../../shared/main/js/mainpage.js" type="text/javascript"></script>
<script src="../../shared/layer/layer.js" type="text/javascript"></script>
<script src="../../shared/js/json2.js" type="text/javascript"></script>
<script type="text/javascript">
var lastReadMessageTime;
var apiUrl = getUrlPath();
	
	$(document).ready(function() {
		dataInit();
		getMessageStatus(lastReadMessageTime);
		intervalFunc();
	});
	function dataInit(){
		$.ajax({
			type : "GET",
			data :{},
			url : apiUrl+"/userInfo",
			dataType : "json",
			async:false,
			success : function(resData) {
				if(resData!=null){
					var data=resData.manageDepartments;
					var userType=resData.type;
					lastReadMessageTime=resData.lastReadMessageTime;
					if(userType!=0){
						$("#identity").append('<option value="0">所属部门</option>');
					}
					for(var i in data){
						if(userType!=data[i].id){
							var name=data[i].departmentId.name+'---'+data[i].roleId.name;
							$("#identity").append('<option value="'+data[i].id+'">'+name+'</option>');
						}
					}
				} 
			}
		});
	}
	function intervalFunc(){
		setTimeout(function () {
			getMessageStatus(lastReadMessageTime);
            //递归调用函数
            intervalFunc();
        },180000);//设置消息没五分钟检查一次
	}
	function getMessageStatus(lastReadMessageTime){
		$.ajax({
			type : "GET",
			data :{},
			url : apiUrl+"/message/have?lastReadMessageTime="+lastReadMessageTime+"&noCache="+new Date().getTime(),
			dataType : "json",
			async:false,
			success : function(resData) {
				if(resData){
					$("#redPoint").show();
				} else{
					$("#redPoint").hide();
				}
			}
		});
	}
	function openAccount(){
		layer.open({
			type: 2, 
			title: "我的账户",
			area: ['850px', '500px'],
			content: './account.html',
			btn: ['关闭'],
		});
	}
	function openChangeRole(){
		$("#myModal").modal('show');
	}
	function changeRole(){
		var identity=$("#identity").val();
		var res=JSON.stringify({id:identity});
		$.ajax({
			type : "POST",
			data :res,
			url : apiUrl+"/cutLogin?noCache="+new Date().getTime(),
			dataType : "json",
			contentType:"application/json;charset=UTF-8",
			async:false,
			success : function(resData) {
				if(resData!=null){
					$("#myModal").modal('hide');
					window.location.reload(true);
				} 
			}
		});
		
	}
	function closeModal(){
		$("#myModal").modal('hide');
	}
	$("#messageLayer").click(function(){
		layer.open({
			type: 2, 
			title: "我的消息",
			area: ['70%', '95%'],
			skin: 'layui-layer-rim',
			content: '../../module/messageAndException/message-mine.html',
			btn: ['关闭'],
		});
	});
	
	//初始化菜单
	var _islocal="Y";
	$(document).ready(function(){
		var _url = getUrlPath();;
		//加载菜单数据{_url:菜单数据地址,hasFresh:是否带刷新按钮}
		createMenus($("#treeId"),_url,true);
	});
	function logout(){
		layer.confirm( '<p class="text-danger text-center font-s20">确定退出登录？</p>',{
			title:'请确认',btn: ['确定','取消'],
			offset:'100px'
		}, function(){
			$.ajax({
				type : "GET",
				url : apiUrl+"/logout?logout=true",
				dataType : "json",
				contentType:"application/json",
				success : function(retdata) {
					//layer.msg('退出成功', {icon: 1});
					window.location.replace("../../module/login/login.html");
				},
				error : function(xmlhttp,textStatus,errorThrown){
					var o = JSON.parse(xmlhttp.responseText);
					layer.msg(o.message, {icon: 5});
					window.location.replace("../../module/login/login.html");
				}
			});
		});		
	}	
</script>
</body>
</html>